<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeWorld Auto - Stream Anything</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: #0f0f0f;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 20px;
            position: fixed;
            width: 100%;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #e50914;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-bar input, .search-bar select {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .search-bar button {
            background: #e50914;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            color: white;
            cursor: pointer;
        }

        .hero {
            height: 60vh;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1633617477271-d4f351ff7c7c?ixlib=rb-1.2.1&auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            display: flex;
            align-items: center;
            padding-top: 80px;
        }

        .hero-content {
            max-width: 600px;
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .content-card {
            background: #181818;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .content-card:hover {
            transform: scale(1.05);
        }

        .content-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .content-info {
            padding: 15px;
        }

        .watch-container {
            padding-top: 80px;
            display: none;
        }

        .iframe-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
        }

        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #e50914;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">AnimeWorld Auto</div>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search anime or cartoon...">
                    <select id="contentType">
                        <option value="anime">Anime</option>
                        <option value="cartoon">Cartoon</option>
                    </select>
                    <button onclick="performSearch()">Search</button>
                </div>
            </div>
        </div>
    </header>

    <div id="homepage">
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h1>Stream Any Anime or Cartoon</h1>
                    <p>Auto-scraping from AnimeWorld • No database required</p>
                    <div style="margin-top: 20px;">
                        <button onclick="loadPopular()" style="background: #e50914; color: white; border: none; padding: 12px 30px; border-radius: 4px; cursor: pointer;">
                            Browse Popular Anime
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div class="container">
            <div id="contentSection">
                <h2>Search for content to get started</h2>
                <p>Enter an anime or cartoon name above and click search</p>
            </div>
        </div>
    </div>

    <div id="watchPage" class="watch-container">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h1 id="watchTitle">Loading...</h1>
                <button onclick="showHomepage()" style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                    ← Back to Search
                </button>
            </div>
            
            <div class="iframe-container">
                <iframe id="playerFrame" allowfullscreen></iframe>
            </div>
            
            <div style="margin: 20px 0;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" id="episodeInput" value="1" min="1" style="padding: 10px; background: #333; color: white; border: none; border-radius: 4px; width: 80px;">
                    <button onclick="loadCurrentEpisode()" style="background: #e50914; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                        Load Episode
                    </button>
                </div>
                <div id="serverInfo" style="margin-top: 10px; color: #999;">Select an episode</div>
            </div>

            <div style="display: flex; gap: 10px; margin: 20px 0;">
                <button id="prevEpisode" onclick="changeEpisode(-1)" style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;" disabled>
                    ← Previous
                </button>
                <button id="nextEpisode" onclick="changeEpisode(1)" style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                    Next →
                </button>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div id="loadingText" style="color: white; margin-top: 20px;">Loading...</div>
    </div>

    <script>
        // API Configuration - UPDATE THIS WITH YOUR DEPLOYED URL
        const API_BASE_URL = 'http://localhost:3001'; // Change to your deployed URL
        
        let currentContent = null;
        let currentEpisode = 1;
        let maxEpisodes = 24;

        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            const type = document.getElementById('contentType').value;
            
            if (!query) {
                alert('Please enter a search term');
                return;
            }

            showLoading('Searching...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/search/${encodeURIComponent(query)}?type=${type}`);
                const data = await response.json();
                
                if (data.success) {
                    displaySearchResults(data.results, query, type);
                } else {
                    throw new Error('Search failed');
                }
            } catch (error) {
                console.error('Search error:', error);
                alert('Search failed. Please try again.');
            }
            
            hideLoading();
        }

        function displaySearchResults(results, query, type) {
            const contentSection = document.getElementById('contentSection');
            
            if (results.length === 0) {
                contentSection.innerHTML = `
                    <h2>No results found for "${query}"</h2>
                    <p>Try a different search term or check the spelling.</p>
                `;
                return;
            }

            contentSection.innerHTML = `
                <h2>Search Results for "${query}" (${results.length} found)</h2>
                <div class="content-grid" id="resultsGrid"></div>
            `;

            const grid = document.getElementById('resultsGrid');
            grid.innerHTML = results.map(item => `
                <div class="content-card" onclick="selectContent('${item.id}', '${item.title}', '${type}', ${item.episodes || 24})">
                    <img src="${item.image || 'https://via.placeholder.com/300x400/181818/FFFFFF?text=No+Image'}" alt="${item.title}">
                    <div class="content-info">
                        <div style="font-weight: bold; margin-bottom: 5px;">${item.title}</div>
                        <div style="font-size: 12px; color: #999;">
                            ${item.type} • ${item.episodes || '?'} episodes
                            ${item.score ? `• ⭐ ${item.score}` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectContent(contentId, title, type, episodes = 24) {
            currentContent = { id: contentId, title: title, type: type };
            maxEpisodes = episodes;
            currentEpisode = 1;
            showWatchPage();
            loadEpisode();
        }

        async function loadEpisode() {
            if (!currentContent) return;

            showLoading(`Loading ${currentContent.title} - Episode ${currentEpisode}...`);
            
            try {
                let apiUrl;
                if (currentContent.type === 'anime') {
                    apiUrl = `${API_BASE_URL}/api/anime/${currentContent.id}/1/${currentEpisode}`;
                } else {
                    apiUrl = `${API_BASE_URL}/api/cartoon/${encodeURIComponent(currentContent.title)}/${currentEpisode}`;
                }

                const response = await fetch(apiUrl);
                const data = await response.json();
                
                if (data.success && data.players.length > 0) {
                    const player = data.players[0];
                    document.getElementById('playerFrame').src = player.url;
                    document.getElementById('serverInfo').textContent = `Playing on ${player.name}`;
                    document.getElementById('episodeInput').value = currentEpisode;
                    updateEpisodeUI();
                } else {
                    document.getElementById('serverInfo').textContent = 'No players found for this episode';
                }
            } catch (error) {
                console.error('Load error:', error);
                document.getElementById('serverInfo').textContent = 'Error loading episode';
            }
            
            hideLoading();
        }

        function loadCurrentEpisode() {
            const episode = parseInt(document.getElementById('episodeInput').value);
            if (episode >= 1 && episode <= maxEpisodes) {
                currentEpisode = episode;
                loadEpisode();
            }
        }

        function changeEpisode(direction) {
            const newEpisode = currentEpisode + direction;
            if (newEpisode >= 1 && newEpisode <= maxEpisodes) {
                currentEpisode = newEpisode;
                loadEpisode();
            }
        }

        function updateEpisodeUI() {
            document.getElementById('prevEpisode').disabled = currentEpisode <= 1;
            document.getElementById('nextEpisode').disabled = currentEpisode >= maxEpisodes;
        }

        function showWatchPage() {
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('watchPage').style.display = 'block';
            document.getElementById('watchTitle').textContent = currentContent.title;
        }

        function showHomepage() {
            document.getElementById('watchPage').style.display = 'none';
            document.getElementById('homepage').style.display = 'block';
            currentContent = null;
        }

        async function loadPopular() {
            showLoading('Loading popular anime...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/popular`);
                const data = await response.json();
                
                if (data.success) {
                    displayPopularAnime(data.popular);
                }
            } catch (error) {
                console.error('Popular load error:', error);
            }
            
            hideLoading();
        }

        function displayPopularAnime(animeList) {
            const contentSection = document.getElementById('contentSection');
            contentSection.innerHTML = `
                <h2>Popular Anime</h2>
                <div class="content-grid" id="popularGrid"></div>
            `;

            const grid = document.getElementById('popularGrid');
            grid.innerHTML = animeList.map(anime => `
                <div class="content-card" onclick="selectContent('${anime.id}', '${anime.title}', 'anime', ${anime.episodes || 24})">
                    <img src="${anime.image}" alt="${anime.title}">
                    <div class="content-info">
                        <div style="font-weight: bold; margin-bottom: 5px;">${anime.title}</div>
                        <div style="font-size: 12px; color: #999;">
                            ${anime.episodes || '?'} episodes • ⭐ ${anime.score || 'N/A'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Allow Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Load popular anime on startup
        document.addEventListener('DOMContentLoaded', loadPopular);
    </script>
</body>
</html>
